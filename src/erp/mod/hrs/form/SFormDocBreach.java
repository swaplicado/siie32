/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package erp.mod.hrs.form;

import erp.client.SClientInterface;
import erp.data.SDataConstantsSys;
import erp.gui.session.SSessionCustom;
import erp.mcfg.data.SCfgUtils;
import erp.mod.SModConsts;
import erp.mod.SModSysConsts;
import erp.mod.cfg.db.SDbDocument;
import erp.mod.hrs.db.SDbDocBreach;
import erp.mod.hrs.db.SDbEmployee;
import erp.mod.hrs.utils.SDocUtils;
import erp.musr.data.SDataUser;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.FocusEvent;
import java.awt.event.FocusListener;
import java.util.ArrayList;
import java.util.HashMap;
import javax.swing.JButton;
import javax.swing.JOptionPane;
import javax.swing.JTextField;
import org.joda.time.LocalTime;
import sa.gui.util.SUtilConsts;
import sa.lib.SLibConsts;
import sa.lib.SLibUtils;
import sa.lib.db.SDbConsts;
import sa.lib.db.SDbRegistry;
import sa.lib.gui.SGuiClient;
import sa.lib.gui.SGuiConsts;
import sa.lib.gui.SGuiUtils;
import sa.lib.gui.SGuiValidation;
import sa.lib.gui.bean.SBeanForm;

/**
 *
 * @author Sergio Flores
 */
public class SFormDocBreach extends SBeanForm implements ActionListener, FocusListener {
    
    private SDbDocBreach moRegistry;
    private SDbEmployee moOffender;
    private SPickerEmployee moPickerEmployeeOffender;
    private SPickerEmployee moPickerEmployeeOther;
    private SPickerPreceptSubsections moPickerPreceptSubsections;
    private HashMap<Integer, String> moEmployeesMap;
    private int mnCfgParamHrsDepartmentId;
    private int mnCfgParamHrsRepCompanyId;
    private int mnCfgParamHrsRepUnionId;
    private int mnPrivilegeLevel;
    private int mnEmployeeOffenderId;
    private int mnEmployeeBossId;
    private int mnEmployeeAuthorId;
    private int mnEmployeeUnionId_n;
    private int mnOffenderDepartmentId;
    private int mnOffenderPositionId;
    private ArrayList<int[]> maPreceptSubsectionKeys;

    /**
     * Creates new form SFormDocBreach
     * @param client GUI client.
     * @param title Title.
     */
    public SFormDocBreach(SGuiClient client, String title) {
        setFormSettings(client, SGuiConsts.BEAN_FORM_EDIT, SModConsts.HRS_DOC_BREACH, 0, title);
        initComponents();
        initComponentsCustom();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel = new javax.swing.JPanel();
        jPanelDoc = new javax.swing.JPanel();
        jPanelDocN = new javax.swing.JPanel();
        jPanelDocN1 = new javax.swing.JPanel();
        jlDoc = new javax.swing.JLabel();
        jtfDocName = new javax.swing.JTextField();
        jtfDocCode = new javax.swing.JTextField();
        jPanelDocN2 = new javax.swing.JPanel();
        jlNumber = new javax.swing.JLabel();
        jtfNumber = new javax.swing.JTextField();
        jtfCompanyBranchCode = new javax.swing.JTextField();
        jPanelDocN3 = new javax.swing.JPanel();
        jlDatetime = new javax.swing.JLabel();
        moDatetime = new sa.lib.gui.bean.SBeanFieldDatetime();
        jlDatetimeHelp = new javax.swing.JLabel();
        jPanelDocN4 = new javax.swing.JPanel();
        jPanelDocN5 = new javax.swing.JPanel();
        jlEmployeeOffender = new javax.swing.JLabel();
        jtfEmployeeOffender = new javax.swing.JTextField();
        jbPickEmployeeOffender = new javax.swing.JButton();
        jPanelDocN6 = new javax.swing.JPanel();
        jlOffenderDepartment = new javax.swing.JLabel();
        jtfOffenderDepartmentName = new javax.swing.JTextField();
        jtfOffenderDepartmentCode = new javax.swing.JTextField();
        jckOffenderActive = new javax.swing.JCheckBox();
        jPanelDocN7 = new javax.swing.JPanel();
        jlOffenderPosition = new javax.swing.JLabel();
        jtfOffenderPositionName = new javax.swing.JTextField();
        jtfOffenderPositionCode = new javax.swing.JTextField();
        jckOffenderUnionized = new javax.swing.JCheckBox();
        jPanelDocN8 = new javax.swing.JPanel();
        jlEmployeeBoss = new javax.swing.JLabel();
        jtfEmployeeBoss = new javax.swing.JTextField();
        jbPickEmployeeBoss = new javax.swing.JButton();
        jPanelDocN9 = new javax.swing.JPanel();
        jlEmployeeAuthor = new javax.swing.JLabel();
        jtfEmployeeAuthor = new javax.swing.JTextField();
        jbPickEmployeeAuthor = new javax.swing.JButton();
        jPanelDocN10 = new javax.swing.JPanel();
        jlEmployeeUnion_n = new javax.swing.JLabel();
        jtfEmployeeUnion_n = new javax.swing.JTextField();
        jbPickEmployeeUnion_n = new javax.swing.JButton();
        jPanelDocN11 = new javax.swing.JPanel();
        jPanelDocN12 = new javax.swing.JPanel();
        jPanelDocC = new javax.swing.JPanel();
        jPanelDocC1 = new javax.swing.JPanel();
        jPanelDocC11 = new javax.swing.JPanel();
        jlPreceptSubsections = new javax.swing.JLabel();
        jbPickPreceptSubsections = new javax.swing.JButton();
        jspPreceptSubsections = new javax.swing.JScrollPane();
        jtaPreceptSubsections = new javax.swing.JTextArea();
        jPanelDocS = new javax.swing.JPanel();
        jPanelDocS1 = new javax.swing.JPanel();
        jlFilevault = new javax.swing.JLabel();
        jtfFilevaultId = new javax.swing.JTextField();
        jtfFilevaultTs = new javax.swing.JTextField();
        jtfFileType = new javax.swing.JTextField();
        jbViewFile = new javax.swing.JButton();
        jPanelSan = new javax.swing.JPanel();
        jPanelSanN = new javax.swing.JPanel();
        jlBreachAbstract = new javax.swing.JLabel();
        moTextBreachAbstract = new sa.lib.gui.bean.SBeanFieldText();
        jPanelSanC = new javax.swing.JPanel();
        jPanelSanC1 = new javax.swing.JPanel();
        jPanelSanC11 = new javax.swing.JPanel();
        jlBreachDescrip = new javax.swing.JLabel();
        jspBreachDescrip = new javax.swing.JScrollPane();
        jtaBreachDescrip = new javax.swing.JTextArea();
        jPanelSanC2 = new javax.swing.JPanel();
        jPanelSanC21 = new javax.swing.JPanel();
        jlEndingNotes = new javax.swing.JLabel();
        jPanelSanC22 = new javax.swing.JPanel();
        jcbEndingNotes = new javax.swing.JComboBox();
        jPanelSanC23 = new javax.swing.JPanel();
        moBoolOffenderSign = new sa.lib.gui.bean.SBeanFieldBoolean();

        jPanel.setLayout(new java.awt.BorderLayout());

        jPanelDoc.setBorder(javax.swing.BorderFactory.createTitledBorder("Formato:"));
        jPanelDoc.setLayout(new java.awt.BorderLayout(0, 5));

        jPanelDocN.setLayout(new java.awt.GridLayout(12, 1, 0, 5));

        jPanelDocN1.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jlDoc.setText("Formato:");
        jlDoc.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanelDocN1.add(jlDoc);

        jtfDocName.setEditable(false);
        jtfDocName.setText("TEXT");
        jtfDocName.setFocusable(false);
        jtfDocName.setPreferredSize(new java.awt.Dimension(250, 23));
        jPanelDocN1.add(jtfDocName);

        jtfDocCode.setEditable(false);
        jtfDocCode.setText("TEXT");
        jtfDocCode.setFocusable(false);
        jtfDocCode.setPreferredSize(new java.awt.Dimension(150, 23));
        jPanelDocN1.add(jtfDocCode);

        jPanelDocN.add(jPanelDocN1);

        jPanelDocN2.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jlNumber.setText("Folio:");
        jlNumber.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanelDocN2.add(jlNumber);

        jtfNumber.setEditable(false);
        jtfNumber.setText("0");
        jtfNumber.setFocusable(false);
        jtfNumber.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanelDocN2.add(jtfNumber);

        jtfCompanyBranchCode.setEditable(false);
        jtfCompanyBranchCode.setText("TEXT");
        jtfCompanyBranchCode.setToolTipText("Sucursal");
        jtfCompanyBranchCode.setFocusable(false);
        jtfCompanyBranchCode.setPreferredSize(new java.awt.Dimension(50, 23));
        jPanelDocN2.add(jtfCompanyBranchCode);

        jPanelDocN.add(jPanelDocN2);

        jPanelDocN3.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jlDatetime.setText("Fecha-hr:*");
        jlDatetime.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanelDocN3.add(jlDatetime);
        jPanelDocN3.add(moDatetime);

        jlDatetimeHelp.setForeground(java.awt.Color.gray);
        jlDatetimeHelp.setText("formato: dd/mm/aaaa hh:mm:ss (24 hr)");
        jlDatetimeHelp.setPreferredSize(new java.awt.Dimension(250, 23));
        jPanelDocN3.add(jlDatetimeHelp);

        jPanelDocN.add(jPanelDocN3);

        jPanelDocN4.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));
        jPanelDocN.add(jPanelDocN4);

        jPanelDocN5.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jlEmployeeOffender.setText("Empleado:*");
        jlEmployeeOffender.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanelDocN5.add(jlEmployeeOffender);

        jtfEmployeeOffender.setEditable(false);
        jtfEmployeeOffender.setText("TEXT");
        jtfEmployeeOffender.setFocusable(false);
        jtfEmployeeOffender.setPreferredSize(new java.awt.Dimension(305, 23));
        jPanelDocN5.add(jtfEmployeeOffender);

        jbPickEmployeeOffender.setText("...");
        jbPickEmployeeOffender.setToolTipText("Seleccionar...");
        jbPickEmployeeOffender.setPreferredSize(new java.awt.Dimension(23, 23));
        jPanelDocN5.add(jbPickEmployeeOffender);

        jPanelDocN.add(jPanelDocN5);

        jPanelDocN6.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jlOffenderDepartment.setText("Depto. empleado:");
        jlOffenderDepartment.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanelDocN6.add(jlOffenderDepartment);

        jtfOffenderDepartmentName.setEditable(false);
        jtfOffenderDepartmentName.setText("TEXT");
        jtfOffenderDepartmentName.setFocusable(false);
        jtfOffenderDepartmentName.setPreferredSize(new java.awt.Dimension(250, 23));
        jPanelDocN6.add(jtfOffenderDepartmentName);

        jtfOffenderDepartmentCode.setEditable(false);
        jtfOffenderDepartmentCode.setText("TEXT");
        jtfOffenderDepartmentCode.setFocusable(false);
        jtfOffenderDepartmentCode.setPreferredSize(new java.awt.Dimension(50, 23));
        jPanelDocN6.add(jtfOffenderDepartmentCode);

        jckOffenderActive.setText("Está activo");
        jckOffenderActive.setEnabled(false);
        jckOffenderActive.setFocusable(false);
        jckOffenderActive.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanelDocN6.add(jckOffenderActive);

        jPanelDocN.add(jPanelDocN6);

        jPanelDocN7.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jlOffenderPosition.setText("Puesto empleado:");
        jlOffenderPosition.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanelDocN7.add(jlOffenderPosition);

        jtfOffenderPositionName.setEditable(false);
        jtfOffenderPositionName.setText("TEXT");
        jtfOffenderPositionName.setFocusable(false);
        jtfOffenderPositionName.setPreferredSize(new java.awt.Dimension(250, 23));
        jPanelDocN7.add(jtfOffenderPositionName);

        jtfOffenderPositionCode.setEditable(false);
        jtfOffenderPositionCode.setText("TEXT");
        jtfOffenderPositionCode.setFocusable(false);
        jtfOffenderPositionCode.setPreferredSize(new java.awt.Dimension(50, 23));
        jPanelDocN7.add(jtfOffenderPositionCode);

        jckOffenderUnionized.setText("Es sindicalizado");
        jckOffenderUnionized.setEnabled(false);
        jckOffenderUnionized.setFocusable(false);
        jckOffenderUnionized.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanelDocN7.add(jckOffenderUnionized);

        jPanelDocN.add(jPanelDocN7);

        jPanelDocN8.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jlEmployeeBoss.setText("Jefe inmediato:*");
        jlEmployeeBoss.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanelDocN8.add(jlEmployeeBoss);

        jtfEmployeeBoss.setEditable(false);
        jtfEmployeeBoss.setText("TEXT");
        jtfEmployeeBoss.setFocusable(false);
        jtfEmployeeBoss.setPreferredSize(new java.awt.Dimension(305, 23));
        jPanelDocN8.add(jtfEmployeeBoss);

        jbPickEmployeeBoss.setText("...");
        jbPickEmployeeBoss.setToolTipText("Seleccionar...");
        jbPickEmployeeBoss.setPreferredSize(new java.awt.Dimension(23, 23));
        jPanelDocN8.add(jbPickEmployeeBoss);

        jPanelDocN.add(jPanelDocN8);

        jPanelDocN9.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jlEmployeeAuthor.setText("Reporta:*");
        jlEmployeeAuthor.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanelDocN9.add(jlEmployeeAuthor);

        jtfEmployeeAuthor.setEditable(false);
        jtfEmployeeAuthor.setText("TEXT");
        jtfEmployeeAuthor.setFocusable(false);
        jtfEmployeeAuthor.setPreferredSize(new java.awt.Dimension(305, 23));
        jPanelDocN9.add(jtfEmployeeAuthor);

        jbPickEmployeeAuthor.setText("...");
        jbPickEmployeeAuthor.setToolTipText("Seleccionar...");
        jbPickEmployeeAuthor.setPreferredSize(new java.awt.Dimension(23, 23));
        jPanelDocN9.add(jbPickEmployeeAuthor);

        jPanelDocN.add(jPanelDocN9);

        jPanelDocN10.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jlEmployeeUnion_n.setText("Rep. sindical:");
        jlEmployeeUnion_n.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanelDocN10.add(jlEmployeeUnion_n);

        jtfEmployeeUnion_n.setEditable(false);
        jtfEmployeeUnion_n.setText("TEXT");
        jtfEmployeeUnion_n.setFocusable(false);
        jtfEmployeeUnion_n.setPreferredSize(new java.awt.Dimension(305, 23));
        jPanelDocN10.add(jtfEmployeeUnion_n);

        jbPickEmployeeUnion_n.setText("...");
        jbPickEmployeeUnion_n.setToolTipText("Seleccionar...");
        jbPickEmployeeUnion_n.setPreferredSize(new java.awt.Dimension(23, 23));
        jPanelDocN10.add(jbPickEmployeeUnion_n);

        jPanelDocN.add(jPanelDocN10);

        jPanelDocN11.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));
        jPanelDocN.add(jPanelDocN11);

        jPanelDocN12.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));
        jPanelDocN.add(jPanelDocN12);

        jPanelDoc.add(jPanelDocN, java.awt.BorderLayout.NORTH);

        jPanelDocC.setBorder(javax.swing.BorderFactory.createEmptyBorder(0, 5, 0, 5));
        jPanelDocC.setLayout(new java.awt.BorderLayout());

        jPanelDocC1.setLayout(new java.awt.BorderLayout(0, 5));

        jPanelDocC11.setLayout(new java.awt.BorderLayout());

        jlPreceptSubsections.setText("Faltas cometidas:*");
        jlPreceptSubsections.setPreferredSize(new java.awt.Dimension(400, 23));
        jPanelDocC11.add(jlPreceptSubsections, java.awt.BorderLayout.CENTER);

        jbPickPreceptSubsections.setText("...");
        jbPickPreceptSubsections.setToolTipText("Seleccionar...");
        jbPickPreceptSubsections.setPreferredSize(new java.awt.Dimension(23, 23));
        jPanelDocC11.add(jbPickPreceptSubsections, java.awt.BorderLayout.EAST);

        jPanelDocC1.add(jPanelDocC11, java.awt.BorderLayout.NORTH);

        jspPreceptSubsections.setHorizontalScrollBarPolicy(javax.swing.ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER);
        jspPreceptSubsections.setVerticalScrollBarPolicy(javax.swing.ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS);
        jspPreceptSubsections.setPreferredSize(new java.awt.Dimension(100, 100));

        jtaPreceptSubsections.setEditable(false);
        jtaPreceptSubsections.setBackground(java.awt.SystemColor.control);
        jtaPreceptSubsections.setColumns(20);
        jtaPreceptSubsections.setFont(new java.awt.Font("Arial", 0, 12)); // NOI18N
        jtaPreceptSubsections.setLineWrap(true);
        jtaPreceptSubsections.setRows(5);
        jtaPreceptSubsections.setText("I. Engañarlo el trabajador o en su caso, el sindicato que lo hubiese propuesto o recomendado con certificados falsos o referencias en los que se atribuyan al trabajador capacidad, aptitudes o facultades de que carezca. Esta causa de rescisión dejará de tener efecto después de treinta días de prestar sus servicios el trabajador;\nII. Incurrir el trabajador, durante sus labores, en faltas de probidad u honradez, en actos de violencia, amagos, injurias o malos tratamientos en contra del patrón, sus familiares o del personal directivo o administrativo de la empresa o establecimiento, o en contra de clientes y proveedores del patrón, salvo que medie provocación o que obre en defensa propia;\nIII. Cometer el trabajador contra alguno de sus compañeros, cualquiera de los actos enumerados en la fracción anterior, si como consecuencia de ellos se altera la disciplina del lugar en que se desempeña el trabajo;");
        jtaPreceptSubsections.setWrapStyleWord(true);
        jtaPreceptSubsections.setFocusable(false);
        jspPreceptSubsections.setViewportView(jtaPreceptSubsections);

        jPanelDocC1.add(jspPreceptSubsections, java.awt.BorderLayout.CENTER);

        jPanelDocC.add(jPanelDocC1, java.awt.BorderLayout.CENTER);

        jPanelDoc.add(jPanelDocC, java.awt.BorderLayout.CENTER);

        jPanelDocS.setLayout(new java.awt.GridLayout(1, 1));

        jPanelDocS1.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jlFilevault.setText("Archivo documento:");
        jlFilevault.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanelDocS1.add(jlFilevault);

        jtfFilevaultId.setEditable(false);
        jtfFilevaultId.setText("TEXT");
        jtfFilevaultId.setToolTipText("ID documento");
        jtfFilevaultId.setFocusable(false);
        jtfFilevaultId.setPreferredSize(new java.awt.Dimension(175, 23));
        jPanelDocS1.add(jtfFilevaultId);

        jtfFilevaultTs.setEditable(false);
        jtfFilevaultTs.setText("01/01/2001 00:00:00");
        jtfFilevaultTs.setToolTipText("TS documento");
        jtfFilevaultTs.setFocusable(false);
        jtfFilevaultTs.setPreferredSize(new java.awt.Dimension(125, 23));
        jPanelDocS1.add(jtfFilevaultTs);

        jtfFileType.setEditable(false);
        jtfFileType.setText("TEXT");
        jtfFileType.setToolTipText("Tipo archivo");
        jtfFileType.setFocusable(false);
        jtfFileType.setPreferredSize(new java.awt.Dimension(30, 23));
        jPanelDocS1.add(jtfFileType);

        jbViewFile.setIcon(new javax.swing.ImageIcon(getClass().getResource("/erp/img/icon_std_look.gif"))); // NOI18N
        jbViewFile.setToolTipText("Ver...");
        jbViewFile.setPreferredSize(new java.awt.Dimension(23, 23));
        jPanelDocS1.add(jbViewFile);

        jPanelDocS.add(jPanelDocS1);

        jPanelDoc.add(jPanelDocS, java.awt.BorderLayout.SOUTH);

        jPanel.add(jPanelDoc, java.awt.BorderLayout.CENTER);

        jPanelSan.setBorder(javax.swing.BorderFactory.createTitledBorder("Diligencia:"));
        jPanelSan.setLayout(new java.awt.BorderLayout(0, 5));

        jPanelSanN.setLayout(new java.awt.GridLayout(2, 1));

        jlBreachAbstract.setForeground(new java.awt.Color(0, 102, 102));
        jlBreachAbstract.setText("Falta cometida:*");
        jPanelSanN.add(jlBreachAbstract);

        moTextBreachAbstract.setText("Text");
        jPanelSanN.add(moTextBreachAbstract);

        jPanelSan.add(jPanelSanN, java.awt.BorderLayout.NORTH);

        jPanelSanC.setLayout(new java.awt.BorderLayout());

        jPanelSanC1.setLayout(new java.awt.GridLayout(3, 1, 0, 5));

        jPanelSanC11.setPreferredSize(new java.awt.Dimension(400, 128));
        jPanelSanC11.setLayout(new java.awt.BorderLayout());

        jlBreachDescrip.setForeground(new java.awt.Color(0, 102, 102));
        jlBreachDescrip.setText("Descripción de la falta:*");
        jlBreachDescrip.setPreferredSize(new java.awt.Dimension(400, 23));
        jPanelSanC11.add(jlBreachDescrip, java.awt.BorderLayout.PAGE_START);

        jspBreachDescrip.setHorizontalScrollBarPolicy(javax.swing.ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER);
        jspBreachDescrip.setVerticalScrollBarPolicy(javax.swing.ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS);
        jspBreachDescrip.setPreferredSize(new java.awt.Dimension(100, 125));

        jtaBreachDescrip.setColumns(20);
        jtaBreachDescrip.setFont(new java.awt.Font("Arial", 0, 12)); // NOI18N
        jtaBreachDescrip.setLineWrap(true);
        jtaBreachDescrip.setRows(5);
        jtaBreachDescrip.setText("The quick brown fox jumps over the lazy dog. The quick brown fox jumps over the lazy dog. The quick brown fox jumps over the lazy dog. The quick brown fox jumps over the lazy dog. The quick brown fox jumps over the lazy dog.");
        jtaBreachDescrip.setWrapStyleWord(true);
        jspBreachDescrip.setViewportView(jtaBreachDescrip);

        jPanelSanC11.add(jspBreachDescrip, java.awt.BorderLayout.CENTER);

        jPanelSanC1.add(jPanelSanC11);

        jPanelSanC.add(jPanelSanC1, java.awt.BorderLayout.PAGE_START);

        jPanelSanC2.setLayout(new java.awt.GridLayout(3, 0));

        jPanelSanC21.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 0, 5));

        jlEndingNotes.setForeground(new java.awt.Color(0, 102, 102));
        jlEndingNotes.setText("Comentarios finales:");
        jlEndingNotes.setPreferredSize(new java.awt.Dimension(400, 23));
        jPanelSanC21.add(jlEndingNotes);

        jPanelSanC2.add(jPanelSanC21);

        jPanelSanC22.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 0, 0));

        jcbEndingNotes.setEditable(true);
        jcbEndingNotes.setPreferredSize(new java.awt.Dimension(400, 23));
        jPanelSanC22.add(jcbEndingNotes);

        jPanelSanC2.add(jPanelSanC22);

        jPanelSanC23.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 0, 5));

        moBoolOffenderSign.setText("El empleado firmó");
        moBoolOffenderSign.setPreferredSize(new java.awt.Dimension(150, 23));
        jPanelSanC23.add(moBoolOffenderSign);

        jPanelSanC2.add(jPanelSanC23);

        jPanelSanC.add(jPanelSanC2, java.awt.BorderLayout.CENTER);

        jPanelSan.add(jPanelSanC, java.awt.BorderLayout.CENTER);

        jPanel.add(jPanelSan, java.awt.BorderLayout.EAST);

        getContentPane().add(jPanel, java.awt.BorderLayout.CENTER);
    }// </editor-fold>//GEN-END:initComponents

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel jPanel;
    private javax.swing.JPanel jPanelDoc;
    private javax.swing.JPanel jPanelDocC;
    private javax.swing.JPanel jPanelDocC1;
    private javax.swing.JPanel jPanelDocC11;
    private javax.swing.JPanel jPanelDocN;
    private javax.swing.JPanel jPanelDocN1;
    private javax.swing.JPanel jPanelDocN10;
    private javax.swing.JPanel jPanelDocN11;
    private javax.swing.JPanel jPanelDocN12;
    private javax.swing.JPanel jPanelDocN2;
    private javax.swing.JPanel jPanelDocN3;
    private javax.swing.JPanel jPanelDocN4;
    private javax.swing.JPanel jPanelDocN5;
    private javax.swing.JPanel jPanelDocN6;
    private javax.swing.JPanel jPanelDocN7;
    private javax.swing.JPanel jPanelDocN8;
    private javax.swing.JPanel jPanelDocN9;
    private javax.swing.JPanel jPanelDocS;
    private javax.swing.JPanel jPanelDocS1;
    private javax.swing.JPanel jPanelSan;
    private javax.swing.JPanel jPanelSanC;
    private javax.swing.JPanel jPanelSanC1;
    private javax.swing.JPanel jPanelSanC11;
    private javax.swing.JPanel jPanelSanC2;
    private javax.swing.JPanel jPanelSanC21;
    private javax.swing.JPanel jPanelSanC22;
    private javax.swing.JPanel jPanelSanC23;
    private javax.swing.JPanel jPanelSanN;
    private javax.swing.JButton jbPickEmployeeAuthor;
    private javax.swing.JButton jbPickEmployeeBoss;
    private javax.swing.JButton jbPickEmployeeOffender;
    private javax.swing.JButton jbPickEmployeeUnion_n;
    private javax.swing.JButton jbPickPreceptSubsections;
    private javax.swing.JButton jbViewFile;
    private javax.swing.JComboBox jcbEndingNotes;
    private javax.swing.JCheckBox jckOffenderActive;
    private javax.swing.JCheckBox jckOffenderUnionized;
    private javax.swing.JLabel jlBreachAbstract;
    private javax.swing.JLabel jlBreachDescrip;
    private javax.swing.JLabel jlDatetime;
    private javax.swing.JLabel jlDatetimeHelp;
    private javax.swing.JLabel jlDoc;
    private javax.swing.JLabel jlEmployeeAuthor;
    private javax.swing.JLabel jlEmployeeBoss;
    private javax.swing.JLabel jlEmployeeOffender;
    private javax.swing.JLabel jlEmployeeUnion_n;
    private javax.swing.JLabel jlEndingNotes;
    private javax.swing.JLabel jlFilevault;
    private javax.swing.JLabel jlNumber;
    private javax.swing.JLabel jlOffenderDepartment;
    private javax.swing.JLabel jlOffenderPosition;
    private javax.swing.JLabel jlPreceptSubsections;
    private javax.swing.JScrollPane jspBreachDescrip;
    private javax.swing.JScrollPane jspPreceptSubsections;
    private javax.swing.JTextArea jtaBreachDescrip;
    private javax.swing.JTextArea jtaPreceptSubsections;
    private javax.swing.JTextField jtfCompanyBranchCode;
    private javax.swing.JTextField jtfDocCode;
    private javax.swing.JTextField jtfDocName;
    private javax.swing.JTextField jtfEmployeeAuthor;
    private javax.swing.JTextField jtfEmployeeBoss;
    private javax.swing.JTextField jtfEmployeeOffender;
    private javax.swing.JTextField jtfEmployeeUnion_n;
    private javax.swing.JTextField jtfFileType;
    private javax.swing.JTextField jtfFilevaultId;
    private javax.swing.JTextField jtfFilevaultTs;
    private javax.swing.JTextField jtfNumber;
    private javax.swing.JTextField jtfOffenderDepartmentCode;
    private javax.swing.JTextField jtfOffenderDepartmentName;
    private javax.swing.JTextField jtfOffenderPositionCode;
    private javax.swing.JTextField jtfOffenderPositionName;
    private sa.lib.gui.bean.SBeanFieldBoolean moBoolOffenderSign;
    private sa.lib.gui.bean.SBeanFieldDatetime moDatetime;
    private sa.lib.gui.bean.SBeanFieldText moTextBreachAbstract;
    // End of variables declaration//GEN-END:variables

    private void initComponentsCustom() {
        SGuiUtils.setWindowBounds(this, 960, 600);

        moDatetime.setDateSettings(miClient, SGuiUtils.getLabelName(jlDatetime), true);
        moTextBreachAbstract.setTextSettings(SGuiUtils.getLabelName(jlBreachAbstract), 100);
        moTextBreachAbstract.setTextCaseType(0);
        
        moBoolOffenderSign.setBooleanSettings(moBoolOffenderSign.getText(), false);
        jcbEndingNotes.setEditable(true);

        moFields.addField(moDatetime);
        moFields.addField(moTextBreachAbstract);
        moFields.addField(moBoolOffenderSign);

        moFields.setFormButton(jbSave);
        
        moPickerEmployeeOffender = new SPickerEmployee(miClient, false);
        moPickerEmployeeOther = new SPickerEmployee(miClient, true);
        moPickerPreceptSubsections = new SPickerPreceptSubsections(miClient);
        moEmployeesMap = new HashMap<>();
        
        try {
            mnCfgParamHrsDepartmentId = SLibUtils.parseInt(SCfgUtils.getParamValue(miClient.getSession().getStatement(), SDataConstantsSys.CFG_PARAM_DOC_HRS_DEP));
            mnCfgParamHrsRepCompanyId = SLibUtils.parseInt(SCfgUtils.getParamValue(miClient.getSession().getStatement(), SDataConstantsSys.CFG_PARAM_DOC_HRS_REP_COM));
            mnCfgParamHrsRepUnionId = SLibUtils.parseInt(SCfgUtils.getParamValue(miClient.getSession().getStatement(), SDataConstantsSys.CFG_PARAM_DOC_HRS_REP_UNI));
        }
        catch (Exception e) {
            SLibUtils.showException(this, e);
        }
        
        mnPrivilegeLevel = ((SClientInterface) miClient).getSessionXXX().getUser().hasRight((SClientInterface) miClient, SDataConstantsSys.PRV_HRS_DOC_BREACH).Level;
    }
    
    private void validateShowForm() throws Exception {
        msCanShowFormMessage = "";
        mbCanShowForm = true;
        
        int[] brancKey = ((SSessionCustom) miClient.getSession().getSessionCustom()).getCurrentBranchKey();
        
        if (brancKey == null || brancKey[0] == 0) {
            msCanShowFormMessage = "Tu sesión de usuario no tiene seleccionada una sucursal de la empresa.";
            mbCanShowForm = false;
        }
        else if (mnPrivilegeLevel < SUtilConsts.LEV_CAPTURE) {
            msCanShowFormMessage = "Tu usuario no tiene permiso para capturar registros.";
            mbCanShowForm = false;
        }
        else if (mnPrivilegeLevel == SUtilConsts.LEV_CAPTURE && ((SDataUser) miClient.getSession().getUser()).getFkBizPartnerId_n() == 0) {
            msCanShowFormMessage = "Tu usuario no tiene asignado un asociado de negocios.\n"
                    + "Contacta al administrador del sistema, y reinicia tu sesión para actualizar la nueva configuración.";
            mbCanShowForm = false;
        }
        else if (mnCfgParamHrsDepartmentId == 0) {
            msCanShowFormMessage = "No se ha configurado en esta empresa cuál es el departamento de RRHH.\n"
                    + "Contacta al administrador del sistema, y reinicia tu sesión para actualizar la nueva configuración.";
            mbCanShowForm = false;
        }
        else if (mnCfgParamHrsRepCompanyId == 0) {
            msCanShowFormMessage = "No se ha configurado en esta empresa quién es el representante patronal.\n"
                    + "Contacta al administrador del sistema, y reinicia tu sesión para actualizar la nueva configuración.";
            mbCanShowForm = false;
        }
        
        if (!msCanShowFormMessage.isEmpty()) {
            throw new Exception(msCanShowFormMessage);
        }
    }
    
    private String getEmployeeName(final int employeeId) {
        String name = moEmployeesMap.get(employeeId);
        
        if (name == null) {
            name = (String) miClient.getSession().readField(SModConsts.HRSU_EMP, new int[] { employeeId }, SDbRegistry.FIELD_NAME);
            moEmployeesMap.put(employeeId, name);
        }
        
        return name;
    }
    
    private void showEmployee(final int employeeMode, final int employeeId, final boolean showOffenderData) {
        int effectiveId = 0;
        JTextField employee = null;
        
        switch (employeeMode) {
            case SPickerEmployee.MODE_OFFENDER:
                mnEmployeeOffenderId = effectiveId = employeeId;
                employee = jtfEmployeeOffender;
                break;
                
            case SPickerEmployee.MODE_BOSS:
                mnEmployeeBossId = effectiveId = employeeId;
                employee = jtfEmployeeBoss;
                break;
                
            case SPickerEmployee.MODE_AUTHOR:
                mnEmployeeAuthorId = effectiveId = employeeId;
                employee = jtfEmployeeAuthor;
                break;
                
            case SPickerEmployee.MODE_REP_UNI:
                mnEmployeeUnionId_n = effectiveId = employeeId;
                employee = jtfEmployeeUnion_n;
                break;
                
            default:
                // nothing
        }
        
        // validate special cases:
        
        if (employeeMode == SPickerEmployee.MODE_OFFENDER) {
            if (mnEmployeeOffenderId == 0) {
                // clear offender data:
                
                moOffender = null;

                if (showOffenderData) {
                    showOffenderData(
                            0, 
                            0, 
                            false, 
                            false);
                }
            }
            else {
                // get offender data:
                
                moOffender = (SDbEmployee) miClient.getSession().readRegistry(SModConsts.HRSU_EMP, new int[] { mnEmployeeOffenderId }, SDbConsts.MODE_VERBOSE);

                if (showOffenderData) {
                    showOffenderData(
                            moOffender.getFkDepartmentId(), 
                            moOffender.getFkPositionId(), 
                            moOffender.isUnionized(), 
                            moOffender.isActive());
                }
            }
        }
        else if (employeeMode == SPickerEmployee.MODE_AUTHOR) {
            if (mnEmployeeAuthorId != 0 && moRegistry.isRegistryNew()) {
                SDbEmployee author = (SDbEmployee) miClient.getSession().readRegistry(SModConsts.HRSU_EMP, new int[] { employeeId }, SDbConsts.MODE_VERBOSE);
                if (!author.isActive()) {
                    mnEmployeeAuthorId = effectiveId = 0; // no inactive employees allowed!
                }
            }
        }
        
        // render effective employee's name:
        
        String effectiveName = effectiveId == 0 ? "" : getEmployeeName(effectiveId);
        
        if (employee != null) {
            employee.setText(effectiveName);
            employee.setCaretPosition(0);
        }
    }
    
    private void showOffenderData(final int departmentId, final int positionId, final boolean unionized, final boolean active) {
        mnOffenderDepartmentId = departmentId;
        mnOffenderPositionId = positionId;
        
        if (mnOffenderDepartmentId == 0) {
            jtfOffenderDepartmentName.setText("");
            jtfOffenderDepartmentCode.setText("");
        }
        else {
            jtfOffenderDepartmentName.setText((String) miClient.getSession().readField(SModConsts.HRSU_DEP, new int[] { mnOffenderDepartmentId }, SDbRegistry.FIELD_NAME));
            jtfOffenderDepartmentCode.setText((String) miClient.getSession().readField(SModConsts.HRSU_DEP, new int[] { mnOffenderDepartmentId }, SDbRegistry.FIELD_CODE));
            
            jtfOffenderDepartmentName.setCaretPosition(0);
            jtfOffenderDepartmentCode.setCaretPosition(0);
        }
        
        if (mnOffenderPositionId == 0) {
            jtfOffenderPositionName.setText("");
            jtfOffenderPositionCode.setText("");
        }
        else {
            jtfOffenderPositionName.setText((String) miClient.getSession().readField(SModConsts.HRSU_POS, new int[] { mnOffenderPositionId }, SDbRegistry.FIELD_NAME));
            jtfOffenderPositionCode.setText((String) miClient.getSession().readField(SModConsts.HRSU_POS, new int[] { mnOffenderPositionId }, SDbRegistry.FIELD_CODE));

            jtfOffenderPositionName.setCaretPosition(0);
            jtfOffenderPositionCode.setCaretPosition(0);
        }
        
        
        jckOffenderUnionized.setSelected(unionized);
        jckOffenderActive.setSelected(active);
        
        jbPickEmployeeUnion_n.setEnabled(unionized);
        showEmployee(SPickerEmployee.MODE_REP_UNI, !unionized ? 0 : mnCfgParamHrsRepUnionId, false);
    }
    
    private void updatePreceptSubsections(final ArrayList<int[]> preceptSubsectionKeys) {
        maPreceptSubsectionKeys = new ArrayList<>(preceptSubsectionKeys);
        jtaPreceptSubsections.setText(SDocUtils.composePreceptSubsections(miClient.getSession(), maPreceptSubsectionKeys, "\n"));
        jtaPreceptSubsections.setCaretPosition(0);
    }
    
    private void actionPerformedPickEmployee(final int employeeMode, final SPickerEmployee picker, final JTextField employee, final boolean showOffenderData) {
        picker.resetForm();
        picker.setValue(SPickerEmployee.VAL_MODE, employeeMode);
        picker.setValue(SModConsts.HRSU_EMP, employee.getText());
        picker.setVisible(true);
        
        if (picker.getFormResult() == SGuiConsts.FORM_RESULT_OK) {
            showEmployee(employeeMode, (int) picker.getValue(SModConsts.HRSU_EMP), showOffenderData);
        }
    }

    @SuppressWarnings("unchecked")
    private void actionPerformedPickPreceptSubsections() {
        moPickerPreceptSubsections.resetForm();
        moPickerPreceptSubsections.setValue(SPickerPreceptSubsections.VAL_PREC_SUBSEC_KEYS, maPreceptSubsectionKeys);
        moPickerPreceptSubsections.setVisible(true);
        
        if (moPickerPreceptSubsections.getFormResult() == SGuiConsts.FORM_RESULT_OK) {
            updatePreceptSubsections((ArrayList<int[]>) moPickerPreceptSubsections.getValue(SPickerPreceptSubsections.VAL_PREC_SUBSEC_KEYS));
        }
    }
    
    private void actionPerformedViewFile() {
        if (jbViewFile.isEnabled()) {
            try {
                SDocUtils.viewFile(miClient, SDocUtils.BUCKET_DOC_BREACH, moRegistry.getFilevaultId());
            }
            catch (Exception e) {
                SLibUtils.showException(this, e);
            }
        }
    }
    
    @Override
    public void addAllListeners() {
        jbPickEmployeeOffender.addActionListener(this);
        jbPickEmployeeBoss.addActionListener(this);
        jbPickEmployeeAuthor.addActionListener(this);
        jbPickEmployeeUnion_n.addActionListener(this);
        jbPickPreceptSubsections.addActionListener(this);
        jbViewFile.addActionListener(this);
        jcbEndingNotes.getEditor().getEditorComponent().addFocusListener(this);
    }

    @Override
    public void removeAllListeners() {
        jbPickEmployeeOffender.removeActionListener(this);
        jbPickEmployeeBoss.removeActionListener(this);
        jbPickEmployeeAuthor.removeActionListener(this);
        jbPickEmployeeUnion_n.removeActionListener(this);
        jbPickPreceptSubsections.removeActionListener(this);
        jbViewFile.removeActionListener(this);
        jcbEndingNotes.getEditor().getEditorComponent().removeFocusListener(this);
    }

    @Override
    @SuppressWarnings("unchecked")
    public void reloadCatalogues() {
        try {
            jcbEndingNotes.removeAllItems();
            String breaches[] = SCfgUtils.getParamValue(miClient.getSession().getStatement(), SDataConstantsSys.CFG_PARAM_DOC_HRS_NTS_BREACH).split(";");
            for (String breach : breaches) {
                jcbEndingNotes.addItem(breach);
            }
        }
        catch (Exception e) {
            SLibUtils.showException(this, e);
        }
    }

    @Override
    @SuppressWarnings("unchecked")
    public void setRegistry(SDbRegistry registry) throws Exception {
        validateShowForm();
        
        moRegistry = (SDbDocBreach) registry;

        mnFormResult = SLibConsts.UNDEFINED;
        mbFirstActivation = true;

        removeAllListeners();
        reloadCatalogues();
        
        if (moRegistry.isRegistryNew()) {
            boolean isBeingCopied = moRegistry.getPkDocBreachId() != 0;
            
            moRegistry.initPrimaryKey();
            jtfRegistryKey.setText("");
            
            moRegistry.setNumber(SDbDocBreach.getNextNumber(miClient.getSession()));
            moRegistry.setBreachTs(miClient.getSession().getCurrentDate());
            moRegistry.setFkDocumentId(SDocUtils.getDocCurrentVersionId(miClient.getSession(), SModSysConsts.CFGS_TP_DOC_BREACH));
            moRegistry.setFkCompanyBranchId(((SSessionCustom) miClient.getSession().getSessionCustom()).getCurrentBranchKey()[0]);
            
            mnEmployeeAuthorId = ((SDataUser) miClient.getSession().getUser()).getFkBizPartnerId_n();
            
            if (isBeingCopied && !moRegistry.getFilevaultId().isEmpty()) {
                miClient.showMsgBoxInformation("Se eliminará la información de control del resguardo del archivo del documento (ID: " + moRegistry.getFilevaultId() + ").\n"
                        + "No es recomendable que esta nueva copia tenga la misma información de control que el documento original.");
                moRegistry.setFilevaultId("");
                moRegistry.setFilevaultTs_n(null);
            }
        }
        else {
            jtfRegistryKey.setText(SLibUtils.textKey(moRegistry.getPrimaryKey()));
            
            mnEmployeeAuthorId = moRegistry.getFkEmployeeAuthorId();
        }
                
        mnEmployeeOffenderId = moRegistry.getFkEmployeeOffenderId();
        mnEmployeeBossId = moRegistry.getFkEmployeeBossId();
        mnEmployeeUnionId_n = moRegistry.getFkEmployeeUnionId_n();
        
        SDbDocument document = (SDbDocument) miClient.getSession().readRegistry(SModConsts.CFGU_DOC, new int[] { moRegistry.getFkDocumentId() });

        jtfDocName.setText(document.getName());
        jtfDocName.setCaretPosition(0);
        
        jtfDocCode.setText(document.getCode());
        jtfDocCode.setCaretPosition(0);
        
        jtfNumber.setText("" + moRegistry.getNumber() + (moRegistry.isRegistryNew() ? "*" : ""));
        jtfNumber.setCaretPosition(0);
        
        jtfCompanyBranchCode.setText((String) miClient.getSession().readField(SModConsts.BPSU_BPB, new int[] { moRegistry.getFkCompanyBranchId() }, SDbRegistry.FIELD_CODE));
        jtfCompanyBranchCode.setCaretPosition(0);
        
        moDatetime.setValue(moRegistry.getBreachTs());
        
        showEmployee(SPickerEmployee.MODE_OFFENDER, mnEmployeeOffenderId, false);
        showOffenderData(
                moRegistry.getFkOffenderDepartmentId(), 
                moRegistry.getFkOffenderPositionId(), 
                moRegistry.isOffenderUnionized(), 
                moOffender == null ? false : moOffender.isActive()); // offender just read in method showEmployee()
        
        showEmployee(SPickerEmployee.MODE_BOSS, mnEmployeeBossId, false);
        showEmployee(SPickerEmployee.MODE_AUTHOR, mnEmployeeAuthorId, false);
        showEmployee(SPickerEmployee.MODE_REP_UNI, mnEmployeeUnionId_n, false);
        
        updatePreceptSubsections(moRegistry.getPreceptSubsectionKeys());
        
        jtfFilevaultId.setText(moRegistry.getFilevaultId());
        jtfFilevaultId.setCaretPosition(0);
        
        jtfFilevaultTs.setText(moRegistry.getFilevaultTs_n() == null ? "" : SLibUtils.DateFormatDatetime.format(moRegistry.getFilevaultTs_n()));
        jtfFilevaultTs.setCaretPosition(0);
        
        jtfFileType.setText(moRegistry.getFileType());
        jtfFileType.setCaretPosition(0);
        
        moTextBreachAbstract.setValue(moRegistry.getBreachAbstract());
        
        jtaBreachDescrip.setText(moRegistry.getBreachDescrip());
        jtaBreachDescrip.setCaretPosition(0);

        jcbEndingNotes.addItem(moRegistry.getEndingNotes());
        jcbEndingNotes.setSelectedIndex(jcbEndingNotes.getItemCount()-1);
        ((JTextField)jcbEndingNotes.getEditor().getEditorComponent()).setCaretPosition(0);

        moBoolOffenderSign.setValue(moRegistry.isOffenderSigned());

        setFormEditable(true);
        
        jbPickEmployeeAuthor.setEnabled(mnPrivilegeLevel > SUtilConsts.LEV_CAPTURE);
        jbViewFile.setEnabled(!moRegistry.getFilevaultId().isEmpty());
        jbSave.setEnabled(moRegistry.getFilevaultId().isEmpty());
        
        if (moRegistry.isRegistryNew()) {
            
        }
        else {
            
        }

        addAllListeners();
    }

    @Override
    public SDbRegistry getRegistry() throws Exception {
        SDbDocBreach registry = moRegistry.clone();

        if (registry.isRegistryNew()) {
            registry.setNumber(0); // reset number so it can be regenerated
        }

        //registry.setPkDocBreachId(...);
        //registry.setNumber(...);
        registry.setBreachTs(moDatetime.getValue());
        registry.setBreachAbstract(moTextBreachAbstract.getValue());
        registry.setBreachDescrip(jtaBreachDescrip.getText());
        registry.setEndingNotes(jcbEndingNotes.getSelectedItem() == null ? "" : jcbEndingNotes.getSelectedItem().toString());
        //registry.setFilevaultId(...);
        //registry.setFilevaultTs_n(...);
        registry.setOffenderUnionized(jckOffenderUnionized.isSelected());
        registry.setOffenderSigned(moBoolOffenderSign.getValue());
        //registry.setDeleted(...);
        //registry.setFkDocumentId(...); // immutable member
        //registry.setFkCompanyBranchId(...); // immutable member
        registry.setFkEmployeeAuthorId(mnEmployeeAuthorId);
        registry.setFkEmployeeOffenderId(mnEmployeeOffenderId);
        registry.setFkEmployeeBossId(mnEmployeeBossId);
        registry.setFkEmployeeUnionId_n(mnEmployeeUnionId_n);
        registry.setFkOffenderDepartmentId(mnOffenderDepartmentId);
        registry.setFkOffenderPositionId(mnOffenderPositionId);
        //registry.setFkUserInsertId(...);
        //registry.setFkUserUpdateId(...);
        //registry.setTsUserInsert(...);
        //registry.setTsUserUpdate(...);
        
        registry.setPreceptSubsectionKeys(maPreceptSubsectionKeys);

        return registry;
    }

    @Override
    public SGuiValidation validateForm() {
        SGuiValidation validation = moFields.validateFields();
        
        if (validation.isValid()) {
            LocalTime localTime = new LocalTime(moDatetime.getValue());
            if (localTime.getMillisOfDay() == 0) {
                if (miClient.showMsgBoxConfirm("¿Estás seguro/a que no deseas espeficar la hora para el campo '" + moDatetime.getFieldName() + "'?") != JOptionPane.YES_OPTION) {
                    validation.setMessage(SGuiConsts.ERR_MSG_FIELD_DIF + "'" + moDatetime.getFieldName() + "':\n"
                            + "horas, minutos y segundos en formato: hh:mm:ss (24 hr)");
                    validation.setComponent(moDatetime.getComponent().getEditor());
                }
            }
        }
        
        if (validation.isValid()) {
            if (mnEmployeeOffenderId == 0) {
                validation.setMessage(SGuiConsts.ERR_MSG_FIELD_REQ + "'" + SGuiUtils.getLabelName(jlEmployeeOffender) + "'.");
                validation.setComponent(jbPickEmployeeOffender);
            }
            else if (mnEmployeeBossId == 0) {
                validation.setMessage(SGuiConsts.ERR_MSG_FIELD_REQ + "'" + SGuiUtils.getLabelName(jlEmployeeBoss) + "'.");
                validation.setComponent(jbPickEmployeeBoss);
            }
            else if (mnEmployeeAuthorId == 0) {
                validation.setMessage(SGuiConsts.ERR_MSG_FIELD_REQ + "'" + SGuiUtils.getLabelName(jlEmployeeAuthor) + "'.");
                validation.setComponent(jbPickEmployeeAuthor);
            }
            else if (jckOffenderUnionized.isSelected() && mnEmployeeUnionId_n == 0) {
                validation.setMessage(SGuiConsts.ERR_MSG_FIELD_REQ + "'" + SGuiUtils.getLabelName(jlEmployeeUnion_n) + "'.");
                validation.setComponent(jbPickEmployeeUnion_n);
            }
            else {
                jtaPreceptSubsections.setText(SLibUtils.textTrim(jtaPreceptSubsections.getText()));
                jtaBreachDescrip.setText(SLibUtils.textTrim(jtaBreachDescrip.getText()));
                
                if (jtaPreceptSubsections.getText().isEmpty()) {
                    validation.setMessage(SGuiConsts.ERR_MSG_FIELD_REQ + "'" + SGuiUtils.getLabelName(jlPreceptSubsections) + "'.");
                    validation.setComponent(jbPickPreceptSubsections);
                }
                else if (jtaBreachDescrip.getText().isEmpty()) {
                    validation.setMessage(SGuiConsts.ERR_MSG_FIELD_REQ + "'" + SGuiUtils.getLabelName(jlBreachDescrip) + "'.");
                    validation.setComponent(jtaBreachDescrip);
                }
            }
        }

        return validation;
    }

    @Override
    public void actionPerformed(ActionEvent e) {
        if (e.getSource() instanceof JButton) {
            JButton button = (JButton) e.getSource();
            
            if (button == jbPickEmployeeOffender) {
                actionPerformedPickEmployee(SPickerEmployee.MODE_OFFENDER, moPickerEmployeeOffender, jtfEmployeeOffender, true);
            }
            else if (button == jbPickEmployeeBoss) {
                actionPerformedPickEmployee(SPickerEmployee.MODE_BOSS, moPickerEmployeeOther, jtfEmployeeBoss, false);
            }
            else if (button == jbPickEmployeeAuthor) {
                actionPerformedPickEmployee(SPickerEmployee.MODE_AUTHOR, moPickerEmployeeOther, jtfEmployeeAuthor, false);
            }
            else if (button == jbPickEmployeeUnion_n) {
                actionPerformedPickEmployee(SPickerEmployee.MODE_REP_UNI, moPickerEmployeeOther, jtfEmployeeUnion_n, false);
            }
            else if (button == jbPickPreceptSubsections) {
                actionPerformedPickPreceptSubsections();
            }
            else if (button == jbViewFile) {
                actionPerformedViewFile();
            }
        }
    }

    @Override
    public void focusGained(FocusEvent e) { }

    @Override
    @SuppressWarnings("unchecked")
    public void focusLost(FocusEvent e) {
        if (jcbEndingNotes.getSelectedItem() != null && !jcbEndingNotes.getSelectedItem().toString().isEmpty()) {
            String text = jcbEndingNotes.getSelectedItem().toString();
            jcbEndingNotes.removeItem(jcbEndingNotes.getSelectedItem());
            jcbEndingNotes.addItem(SLibUtils.textTrim(text).substring(0, 100));
            jcbEndingNotes.setSelectedIndex(jcbEndingNotes.getItemCount()-1);
            ((JTextField)jcbEndingNotes.getEditor().getEditorComponent()).setCaretPosition(0);
        }
    }
}
