/*
 * SGuiDatePicker.java
 *
 * Created on 3 de abril de 2008, 08:26 PM
 */

package erp.lib.gui;

import erp.lib.SLibConstants;
import erp.lib.SLibTimeUtilities;
import erp.lib.form.SFormUtilities;
import erp.lib.form.SFormValidation;
import java.awt.event.ActionEvent;
import java.awt.event.KeyEvent;
import java.util.Calendar;
import java.util.GregorianCalendar;
import java.util.Locale;
import javax.swing.AbstractAction;
import sa.lib.SLibTimeUtils;

/**
 *
 * @author Sergio Flores
 */
public class SGuiDatePicker extends javax.swing.JDialog implements erp.lib.form.SFormInterface, java.awt.event.ActionListener {

    private int mnFormType;
    private int mnFormResult;
    private int mnFormStatus;
    private boolean mbFirstTime;
    private boolean mbResetingForm;
    private java.util.Vector<erp.lib.form.SFormField> mvFields;
    private erp.client.SClientInterface miClient;

    private java.lang.String[] masMonths;
    private erp.lib.gui.SGuiDate moGuiDate;

    /**
     * Creates new form SGuiDatePicker
     *
     * @param client Client interface.
     * @param formType Constants defined in erp.lib.SLibConstants.
     */
    public SGuiDatePicker(erp.client.SClientInterface client, int formType) {
        super(client.getFrame(), true);
        miClient = client;
        mnFormType = formType;
        initComponents();
        initComponentsExtra();
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        jPanel2 = new javax.swing.JPanel();
        jbPrevYear = new javax.swing.JButton();
        jbPrevMonth = new javax.swing.JButton();
        jPanel3 = new javax.swing.JPanel();
        jlMonth = new javax.swing.JLabel();
        jPanel4 = new javax.swing.JPanel();
        jbNextMonth = new javax.swing.JButton();
        jbNextYear = new javax.swing.JButton();
        jPanel5 = new javax.swing.JPanel();
        jScrollPane1 = new javax.swing.JScrollPane();
        jtCalendar = new javax.swing.JTable();
        jPanel6 = new javax.swing.JPanel();
        jPanel7 = new javax.swing.JPanel();
        jlDate = new javax.swing.JLabel();
        jtfDate = new javax.swing.JTextField();
        jlSystemDate = new javax.swing.JLabel();
        jtfSystemDate = new javax.swing.JTextField();
        jlWorkingDate = new javax.swing.JLabel();
        jtfWorkingDate = new javax.swing.JTextField();
        jPanel8 = new javax.swing.JPanel();
        jPanel9 = new javax.swing.JPanel();
        jbSystemDate = new javax.swing.JButton();
        jbWorkingDate = new javax.swing.JButton();
        jPanel10 = new javax.swing.JPanel();
        jbSelectedDate = new javax.swing.JButton();
        jbSelectedMonth = new javax.swing.JButton();
        jbSelectedYear = new javax.swing.JButton();
        jbCancel = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("Calendario");
        setResizable(false);
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowActivated(java.awt.event.WindowEvent evt) {
                formWindowActivated(evt);
            }
        });

        jPanel1.setLayout(new java.awt.BorderLayout());

        jbPrevYear.setText("<<");
        jbPrevYear.setToolTipText("Año anterior [Ctrl+Re Pág]");
        jbPrevYear.setPreferredSize(new java.awt.Dimension(60, 23));
        jPanel2.add(jbPrevYear);

        jbPrevMonth.setText("<");
        jbPrevMonth.setToolTipText("Mes anterior [Re pág]");
        jbPrevMonth.setPreferredSize(new java.awt.Dimension(60, 23));
        jPanel2.add(jbPrevMonth);

        jPanel1.add(jPanel2, java.awt.BorderLayout.WEST);

        jlMonth.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jlMonth.setText("Enero 2000");
        jlMonth.setPreferredSize(new java.awt.Dimension(150, 20));
        jPanel3.add(jlMonth);

        jPanel1.add(jPanel3, java.awt.BorderLayout.CENTER);

        jbNextMonth.setText(">");
        jbNextMonth.setToolTipText("Mes siguiente [Av pág]");
        jbNextMonth.setPreferredSize(new java.awt.Dimension(60, 23));
        jPanel4.add(jbNextMonth);

        jbNextYear.setText(">>");
        jbNextYear.setToolTipText("Año siguiente [Ctrl+Av Pág]");
        jbNextYear.setPreferredSize(new java.awt.Dimension(60, 23));
        jPanel4.add(jbNextYear);

        jPanel1.add(jPanel4, java.awt.BorderLayout.EAST);

        getContentPane().add(jPanel1, java.awt.BorderLayout.NORTH);

        jPanel5.setBorder(javax.swing.BorderFactory.createEmptyBorder(0, 5, 0, 5));
        jPanel5.setLayout(new java.awt.BorderLayout());

        jtCalendar.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null}
            },
            new String [] {
                "D", "L", "M", "M", "J", "V", "S"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jtCalendar.setCellSelectionEnabled(true);
        jtCalendar.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jtCalendarMouseClicked(evt);
            }
        });
        jScrollPane1.setViewportView(jtCalendar);

        jPanel5.add(jScrollPane1, java.awt.BorderLayout.CENTER);

        getContentPane().add(jPanel5, java.awt.BorderLayout.CENTER);

        jPanel6.setBorder(javax.swing.BorderFactory.createEmptyBorder(5, 0, 0, 0));
        jPanel6.setLayout(new java.awt.BorderLayout());

        jPanel7.setBorder(javax.swing.BorderFactory.createEmptyBorder(0, 5, 0, 5));
        jPanel7.setLayout(new java.awt.GridLayout(1, 6, 5, 5));

        jlDate.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jlDate.setText("F. actual:");
        jlDate.setMaximumSize(new java.awt.Dimension(70, 23));
        jlDate.setMinimumSize(new java.awt.Dimension(70, 23));
        jlDate.setPreferredSize(new java.awt.Dimension(70, 23));
        jPanel7.add(jlDate);

        jtfDate.setEditable(false);
        jtfDate.setHorizontalAlignment(javax.swing.JTextField.CENTER);
        jtfDate.setText("01/01/2000");
        jtfDate.setFocusable(false);
        jtfDate.setMaximumSize(new java.awt.Dimension(70, 23));
        jtfDate.setMinimumSize(new java.awt.Dimension(70, 23));
        jtfDate.setPreferredSize(new java.awt.Dimension(70, 23));
        jPanel7.add(jtfDate);

        jlSystemDate.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jlSystemDate.setText("F. sistema:");
        jlSystemDate.setMaximumSize(new java.awt.Dimension(70, 23));
        jlSystemDate.setMinimumSize(new java.awt.Dimension(70, 23));
        jlSystemDate.setPreferredSize(new java.awt.Dimension(70, 23));
        jPanel7.add(jlSystemDate);

        jtfSystemDate.setEditable(false);
        jtfSystemDate.setHorizontalAlignment(javax.swing.JTextField.CENTER);
        jtfSystemDate.setText("01/01/2000");
        jtfSystemDate.setFocusable(false);
        jtfSystemDate.setMaximumSize(new java.awt.Dimension(70, 23));
        jtfSystemDate.setMinimumSize(new java.awt.Dimension(70, 23));
        jtfSystemDate.setPreferredSize(new java.awt.Dimension(70, 23));
        jPanel7.add(jtfSystemDate);

        jlWorkingDate.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jlWorkingDate.setText("F. trabajo:");
        jlWorkingDate.setMaximumSize(new java.awt.Dimension(70, 23));
        jlWorkingDate.setMinimumSize(new java.awt.Dimension(70, 23));
        jlWorkingDate.setPreferredSize(new java.awt.Dimension(70, 23));
        jPanel7.add(jlWorkingDate);

        jtfWorkingDate.setEditable(false);
        jtfWorkingDate.setHorizontalAlignment(javax.swing.JTextField.CENTER);
        jtfWorkingDate.setText("01/01/2000");
        jtfWorkingDate.setFocusable(false);
        jtfWorkingDate.setMaximumSize(new java.awt.Dimension(70, 23));
        jtfWorkingDate.setMinimumSize(new java.awt.Dimension(70, 23));
        jtfWorkingDate.setPreferredSize(new java.awt.Dimension(70, 23));
        jPanel7.add(jtfWorkingDate);

        jPanel6.add(jPanel7, java.awt.BorderLayout.NORTH);

        jPanel8.setLayout(new java.awt.BorderLayout());

        jPanel9.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT));

        jbSystemDate.setText("F. sistema");
        jbSystemDate.setToolTipText("Fecha de sistema [Ctrl+S]");
        jbSystemDate.setMargin(new java.awt.Insets(2, 0, 2, 0));
        jbSystemDate.setPreferredSize(new java.awt.Dimension(75, 23));
        jPanel9.add(jbSystemDate);

        jbWorkingDate.setText("F. trabajo");
        jbWorkingDate.setToolTipText("Fecha de trabajo [Ctrl+T]");
        jbWorkingDate.setMargin(new java.awt.Insets(2, 0, 2, 0));
        jbWorkingDate.setPreferredSize(new java.awt.Dimension(75, 23));
        jPanel9.add(jbWorkingDate);

        jPanel8.add(jPanel9, java.awt.BorderLayout.WEST);

        jPanel10.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.RIGHT));

        jbSelectedDate.setText("Día");
        jbSelectedDate.setToolTipText("Día actual [Ctrl+D]");
        jbSelectedDate.setMargin(new java.awt.Insets(2, 0, 2, 0));
        jbSelectedDate.setPreferredSize(new java.awt.Dimension(50, 23));
        jPanel10.add(jbSelectedDate);

        jbSelectedMonth.setText("Mes");
        jbSelectedMonth.setToolTipText("Mes actual [Ctrl+M]");
        jbSelectedMonth.setMargin(new java.awt.Insets(2, 0, 2, 0));
        jbSelectedMonth.setPreferredSize(new java.awt.Dimension(50, 23));
        jPanel10.add(jbSelectedMonth);

        jbSelectedYear.setText("Año");
        jbSelectedYear.setToolTipText("Año actual [Ctrl+A]");
        jbSelectedYear.setMargin(new java.awt.Insets(2, 0, 2, 0));
        jbSelectedYear.setPreferredSize(new java.awt.Dimension(50, 23));
        jPanel10.add(jbSelectedYear);

        jbCancel.setText("Cancelar");
        jbCancel.setToolTipText("[Escape]");
        jPanel10.add(jbCancel);

        jPanel8.add(jPanel10, java.awt.BorderLayout.CENTER);

        jPanel6.add(jPanel8, java.awt.BorderLayout.SOUTH);

        getContentPane().add(jPanel6, java.awt.BorderLayout.SOUTH);

        java.awt.Dimension screenSize = java.awt.Toolkit.getDefaultToolkit().getScreenSize();
        setBounds((screenSize.width-440)/2, (screenSize.height-275)/2, 440, 275);
    }// </editor-fold>//GEN-END:initComponents

    private void jtCalendarMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jtCalendarMouseClicked
        if (evt.getClickCount() == 2) {
            actionSelectedDate();
        }
    }//GEN-LAST:event_jtCalendarMouseClicked

    private void formWindowActivated(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowActivated
        if (mbFirstTime) {
            mbFirstTime = false;
            jbPrevYear.requestFocus();
        }
    }//GEN-LAST:event_formWindowActivated

    private void initComponentsExtra() {
        java.lang.String[] asDays = SLibTimeUtilities.createDaysOfWeekStd(Calendar.SHORT);
        masMonths = SLibTimeUtilities.createMonthsOfYear(Locale.getDefault(), Calendar.LONG);

        for (int i = 0; i < jtCalendar.getColumnCount(); i++) {
            jtCalendar.getColumnModel().getColumn(i).setHeaderValue(asDays[i]);
        }

        jbPrevMonth.addActionListener(this);
        jbPrevYear.addActionListener(this);
        jbNextMonth.addActionListener(this);
        jbNextYear.addActionListener(this);
        jbSystemDate.addActionListener(this);
        jbWorkingDate.addActionListener(this);
        jbSelectedDate.addActionListener(this);
        jbSelectedMonth.addActionListener(this);
        jbSelectedYear.addActionListener(this);
        jbCancel.addActionListener(this);

        if (mnFormType == SLibConstants.GUI_DATE_PICKER_DATE) {
            jbSelectedMonth.setEnabled(false);
            jbSelectedYear.setEnabled(false);
        }

        SFormUtilities.createActionMap(rootPane, this, "actionPrevMonth", "prevMonth", KeyEvent.VK_PAGE_UP, 0);
        SFormUtilities.createActionMap(rootPane, this, "actionPrevYear", "prevYear", KeyEvent.VK_PAGE_UP, KeyEvent.CTRL_DOWN_MASK);
        SFormUtilities.createActionMap(rootPane, this, "actionNextMonth", "nextMonth", KeyEvent.VK_PAGE_DOWN, 0);
        SFormUtilities.createActionMap(rootPane, this, "actionNextYear", "nextYear", KeyEvent.VK_PAGE_DOWN, KeyEvent.CTRL_DOWN_MASK);
        SFormUtilities.createActionMap(rootPane, this, "actionSystemDate", "systemDate", KeyEvent.VK_S, KeyEvent.CTRL_DOWN_MASK);
        SFormUtilities.createActionMap(rootPane, this, "actionWorkingDate", "workingDate", KeyEvent.VK_T, KeyEvent.CTRL_DOWN_MASK);
        SFormUtilities.createActionMap(rootPane, this, "actionSelectedDate", "selectedDate", KeyEvent.VK_D, KeyEvent.CTRL_DOWN_MASK);
        SFormUtilities.createActionMap(rootPane, this, "actionSelectedMonth", "selectedMonth", KeyEvent.VK_M, KeyEvent.CTRL_DOWN_MASK);
        SFormUtilities.createActionMap(rootPane, this, "actionSelectedYear", "selectedYear", KeyEvent.VK_A, KeyEvent.CTRL_DOWN_MASK);

        AbstractAction actionCancel = new AbstractAction() {
            @Override
            public void actionPerformed(ActionEvent e) { actionCancel(); }
        };

        SFormUtilities.putActionMap(getRootPane(), actionCancel, "cancel", KeyEvent.VK_ESCAPE, 0);
    }

    private java.util.GregorianCalendar catchSelectedDate() {
        java.util.GregorianCalendar calendar = new GregorianCalendar();
        calendar.setTime(moGuiDate);

        if (jtCalendar.getSelectedRow() != -1 && jtCalendar.getSelectedColumn() != -1) {
            if ((jtCalendar.getValueAt(jtCalendar.getSelectedRow(), jtCalendar.getSelectedColumn())) != null) {
                calendar.set(Calendar.DATE, ((java.lang.Integer) jtCalendar.getValueAt(jtCalendar.getSelectedRow(), jtCalendar.getSelectedColumn())).intValue());
            }
        }

        return calendar;
    }

    private void renderCalendar() {
        int col;
        int row;
        int day;
        int dayMax;
        int colOfFirstDay = 0;
        boolean firstTime = true;
        java.util.GregorianCalendar gc = new GregorianCalendar();

        gc.setTime(moGuiDate);
        jlMonth.setText(masMonths[gc.get(Calendar.MONTH)] + " " + gc.get(Calendar.YEAR));

        // Clear calendar:

        for (row = 0; row < jtCalendar.getRowCount(); row++) {
            for (col = 0; col < jtCalendar.getColumnCount(); col++) {
                jtCalendar.setValueAt(null, row, col);
            }
        }

        // Render calendar:

        gc.set(Calendar.DATE, 1);
        colOfFirstDay = gc.get(Calendar.DAY_OF_WEEK) - (SLibTimeUtilities.getFirstDayOfWeekStd() - 1) - 1;
        if (colOfFirstDay < 0) {
            colOfFirstDay = 7 + colOfFirstDay;  // colOfFirstDay is negative
        }

        gc.setTime(moGuiDate);
        day = 0;
        dayMax = SLibTimeUtilities.getMaxDayOfMonth(moGuiDate);

        for (row = 0; row < jtCalendar.getRowCount() && day < dayMax; row++) {
            for (col = firstTime ? colOfFirstDay : 0; col < jtCalendar.getColumnCount(); col++) {
                firstTime = false;
                jtCalendar.setValueAt(new Integer(++day), row, col);

                if (day == gc.get(Calendar.DATE)) {
                    jtCalendar.setRowSelectionInterval(row, row);
                    jtCalendar.setColumnSelectionInterval(col, col);
                }

                if (day == dayMax) {
                    break;
                }
            }
        }
    }

    private void actionRenderCalendar(int incYear, int incMonth) {
        java.util.GregorianCalendar calendar = catchSelectedDate();
        calendar.add(Calendar.YEAR, incYear);
        calendar.add(Calendar.MONTH, incMonth);
        moGuiDate = new SGuiDate(calendar.getTime().getTime(), SLibConstants.GUI_DATE_AS_DATE);
        renderCalendar();
    }

    private void actionCancel() {
        mnFormResult = SLibConstants.FORM_RESULT_CANCEL;
        setVisible(false);
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel10;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JPanel jPanel6;
    private javax.swing.JPanel jPanel7;
    private javax.swing.JPanel jPanel8;
    private javax.swing.JPanel jPanel9;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JButton jbCancel;
    private javax.swing.JButton jbNextMonth;
    private javax.swing.JButton jbNextYear;
    private javax.swing.JButton jbPrevMonth;
    private javax.swing.JButton jbPrevYear;
    private javax.swing.JButton jbSelectedDate;
    private javax.swing.JButton jbSelectedMonth;
    private javax.swing.JButton jbSelectedYear;
    private javax.swing.JButton jbSystemDate;
    private javax.swing.JButton jbWorkingDate;
    private javax.swing.JLabel jlDate;
    private javax.swing.JLabel jlMonth;
    private javax.swing.JLabel jlSystemDate;
    private javax.swing.JLabel jlWorkingDate;
    private javax.swing.JTable jtCalendar;
    private javax.swing.JTextField jtfDate;
    private javax.swing.JTextField jtfSystemDate;
    private javax.swing.JTextField jtfWorkingDate;
    // End of variables declaration//GEN-END:variables

    public void actionSystemDate() {
        moGuiDate = new SGuiDate(miClient.getSessionXXX().getSystemDate().getTime(), SLibConstants.GUI_DATE_AS_DATE);
        mnFormResult = SLibConstants.FORM_RESULT_OK;
        setVisible(false);
    }

    public void actionWorkingDate() {
        moGuiDate = new SGuiDate(miClient.getSessionXXX().getWorkingDate().getTime(), SLibConstants.GUI_DATE_AS_DATE);
        mnFormResult = SLibConstants.FORM_RESULT_OK;
        setVisible(false);
    }

    public void actionSelectedDate() {
        SFormValidation validation = formValidate();

        if (validation.getIsError()) {
            miClient.showMsgBoxWarning(validation.getMessage());
            if (validation.getComponent() != null) {
                validation.getComponent().requestFocus();
            }
        }
        else {
            moGuiDate = new SGuiDate(catchSelectedDate().getTime().getTime(), SLibConstants.GUI_DATE_AS_DATE);
            mnFormResult = SLibConstants.FORM_RESULT_OK;
            setVisible(false);
        }
    }

    public void actionSelectedMonth() {
        if (jbSelectedMonth.isEnabled()) {
            moGuiDate = new SGuiDate(SLibTimeUtils.getEndOfMonth(catchSelectedDate().getTime()).getTime(), SLibConstants.GUI_DATE_AS_YEAR_MONTH);
            mnFormResult = SLibConstants.FORM_RESULT_OK;
            setVisible(false);
        }
    }

    public void actionSelectedYear() {
        if (jbSelectedYear.isEnabled()) {
            moGuiDate = new SGuiDate(SLibTimeUtils.getEndOfYear(catchSelectedDate().getTime()).getTime(), SLibConstants.GUI_DATE_AS_YEAR);
            mnFormResult = SLibConstants.FORM_RESULT_OK;
            setVisible(false);
        }
    }

    public void actionPrevMonth() {
        actionRenderCalendar(0, -1);
    }

    public void actionPrevYear() {
        actionRenderCalendar(-1, 0);
    }

    public void actionNextMonth() {
        actionRenderCalendar(0, 1);
    }

    public void actionNextYear() {
        actionRenderCalendar(1, 0);
    }

    public void setDate(java.util.Date date) {
        if (date == null) {
            moGuiDate = new SGuiDate(miClient.getSessionXXX().getWorkingDate().getTime(), SLibConstants.GUI_DATE_AS_DATE);
        }
        else {
            moGuiDate = new SGuiDate(date.getTime(), SLibConstants.GUI_DATE_AS_DATE);
        }

        jtfDate.setText(miClient.getSessionXXX().getFormatters().getDateFormat().format(moGuiDate));
        renderCalendar();
    }

    public erp.lib.gui.SGuiDate getGuiDate() {
        return moGuiDate;
    }

    @Override
    public void formClearRegistry() {
        throw new UnsupportedOperationException("Not supported yet.");
    }

    @Override
    public void formReset() {
        mnFormResult = SLibConstants.UNDEFINED;
        mnFormStatus = SLibConstants.UNDEFINED;
        mbFirstTime = true;

        moGuiDate = new SGuiDate(miClient.getSessionXXX().getWorkingDate().getTime(), SLibConstants.GUI_DATE_AS_DATE);
        jtfSystemDate.setText(miClient.getSessionXXX().getFormatters().getDateFormat().format(miClient.getSessionXXX().getSystemDate()));
        jtfWorkingDate.setText(miClient.getSessionXXX().getFormatters().getDateFormat().format(miClient.getSessionXXX().getWorkingDate()));
    }

    @Override
    public void formRefreshCatalogues() {
        throw new UnsupportedOperationException("Not supported yet.");
    }

    @Override
    public erp.lib.form.SFormValidation formValidate() {
        erp.lib.form.SFormValidation validation = new SFormValidation();

        if (!(jtCalendar.getSelectedRow() != -1 && jtCalendar.getSelectedColumn() != -1)) {
            validation.setMessage("Se debe seleccionar una fecha.");
            validation.setComponent(jtCalendar);
        }
        else if (jtCalendar.getValueAt(jtCalendar.getSelectedRow(), jtCalendar.getSelectedColumn()) == null) {
            validation.setMessage("Se debe seleccionar una fecha.");
            validation.setComponent(jtCalendar);
        }

        return validation;
    }

    @Override
    public void setFormStatus(int status) {
        mnFormStatus = status;
    }

    @Override
    public void setFormVisible(boolean visible) {
        setVisible(visible);
    }

    @Override
    public int getFormStatus() {
        return mnFormStatus;
    }

    @Override
    public int getFormResult() {
        return mnFormResult;
    }

    @Override
    public void setRegistry(erp.lib.data.SDataRegistry registry) {
        throw new UnsupportedOperationException("Not supported yet.");
    }

    @Override
    public erp.lib.data.SDataRegistry getRegistry() {
        throw new UnsupportedOperationException("Not supported yet.");
    }

    @Override
    public void setValue(int type, java.lang.Object value) {
        throw new UnsupportedOperationException("Not supported yet.");
    }

    @Override
    public java.lang.Object getValue(int type) {
        throw new UnsupportedOperationException("Not supported yet.");
    }

    @Override
    public javax.swing.JLabel getTimeoutLabel() {
        return null;
    }

    @Override
    public void actionPerformed(java.awt.event.ActionEvent e) {
        if (e.getSource() instanceof javax.swing.JButton) {
            javax.swing.JButton button = (javax.swing.JButton) e.getSource();

            if (button == jbPrevMonth) {
                actionPrevMonth();
            }
            else if (button == jbPrevYear) {
                actionPrevYear();
            }
            else if (button == jbNextMonth) {
                actionNextMonth();
            }
            else if (button == jbNextYear) {
                actionNextYear();
            }
            else if (button == jbSystemDate) {
                actionSystemDate();
            }
            else if (button == jbWorkingDate) {
                actionWorkingDate();
            }
            else if (button == jbSelectedDate) {
                actionSelectedDate();
            }
            else if (button == jbSelectedMonth) {
                actionSelectedMonth();
            }
            else if (button == jbSelectedYear) {
                actionSelectedYear();
            }
            else if (button == jbCancel) {
                actionCancel();
            }
        }
    }

    public erp.lib.gui.SGuiDate pickDate(java.util.Date date) {
        formReset();
        setDate(date);
        setVisible(true);

        if (mnFormResult == SLibConstants.FORM_RESULT_OK) {
            return moGuiDate;
        }

        return null;
    }

    public int pickDate(java.util.Date date, erp.lib.form.SFormField field) {
        formReset();
        setDate(date);
        setVisible(true);

        if (mnFormResult == SLibConstants.FORM_RESULT_OK) {
            field.setDate(moGuiDate);
            field.getComponent().requestFocus();
        }

        return mnFormResult;
    }
}
