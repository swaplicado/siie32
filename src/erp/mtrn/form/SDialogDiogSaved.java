/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * SDialogDiogSaved.java
 *
 * Created on 9/05/2012, 10:31:35 AM
 */

package erp.mtrn.form;

import erp.data.SDataConstants;
import erp.data.SDataConstantsSys;
import erp.data.SDataReadDescriptions;
import erp.lib.SLibConstants;
import erp.lib.SLibUtilities;
import erp.lib.form.SFormUtilities;
import erp.mtrn.data.STrnUtilities;
import java.awt.event.ActionEvent;
import java.awt.event.KeyEvent;
import javax.swing.JButton;

/**
 *
 * @author Sergio Flores, Claudio Peña
 */
public class SDialogDiogSaved extends javax.swing.JDialog implements java.awt.event.ActionListener {

    private boolean mbFirstTime;
    private erp.client.SClientInterface miClient;
    private erp.mtrn.data.SDataDiog moDiog;

    /** Creates new form SDialogDiogSaved */
    public SDialogDiogSaved(erp.client.SClientInterface client) {
        super(client.getFrame(), true);
        miClient = client;
        initComponents();
        initComponentsExtra();
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel2 = new javax.swing.JPanel();
        jPanel3 = new javax.swing.JPanel();
        jPanel4 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        jpDocType = new javax.swing.JPanel();
        jlDiogType = new javax.swing.JLabel();
        jtfDiogType = new javax.swing.JTextField();
        jpDocDate = new javax.swing.JPanel();
        jlDate = new javax.swing.JLabel();
        jtfDate = new javax.swing.JTextField();
        jlSeries = new javax.swing.JLabel();
        jtfNumber = new javax.swing.JTextField();
        jpDocNumber = new javax.swing.JPanel();
        jRef = new javax.swing.JLabel();
        jtfRef = new javax.swing.JTextField();
        jpWarehouseSource = new javax.swing.JPanel();
        jlWarehouseSource = new javax.swing.JLabel();
        jtfCompanyBranchSource = new javax.swing.JTextField();
        jtfCompanyBranchSourceCode = new javax.swing.JTextField();
        jtfWarehouseSource = new javax.swing.JTextField();
        jtfWarehouseSourceCode = new javax.swing.JTextField();
        jpWarehouseDestiny = new javax.swing.JPanel();
        jlWarehouseDestiny = new javax.swing.JLabel();
        jtfCompanyBranchDestiny = new javax.swing.JTextField();
        jtfCompanyBranchDestinyCode = new javax.swing.JTextField();
        jtfWarehouseDestiny = new javax.swing.JTextField();
        jtfWarehouseDestinyCode = new javax.swing.JTextField();
        jPanel1 = new javax.swing.JPanel();
        jbPrintClose = new javax.swing.JButton();
        jbSaveArchive = new javax.swing.JButton();
        jbClose = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("Documento de inventarios");
        setResizable(false);
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowActivated(java.awt.event.WindowEvent evt) {
                formWindowActivated(evt);
            }
        });

        jPanel2.setLayout(new java.awt.BorderLayout());

        jPanel3.setLayout(new java.awt.GridLayout(6, 1, 0, 5));

        jPanel4.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jLabel1.setText("El documento ha sido guardado conforme a los siguientes datos:");
        jLabel1.setPreferredSize(new java.awt.Dimension(430, 23));
        jPanel4.add(jLabel1);

        jPanel3.add(jPanel4);

        jpDocType.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jlDiogType.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        jlDiogType.setText("Tipo documento:");
        jlDiogType.setPreferredSize(new java.awt.Dimension(100, 23));
        jpDocType.add(jlDiogType);

        jtfDiogType.setEditable(false);
        jtfDiogType.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        jtfDiogType.setText("DOCUMENT TYPE");
        jtfDiogType.setFocusable(false);
        jtfDiogType.setPreferredSize(new java.awt.Dimension(325, 23));
        jpDocType.add(jtfDiogType);

        jPanel3.add(jpDocType);

        jpDocDate.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jlDate.setText("Fecha:");
        jlDate.setPreferredSize(new java.awt.Dimension(100, 23));
        jpDocDate.add(jlDate);

        jtfDate.setEditable(false);
        jtfDate.setText("01/01/2012");
        jtfDate.setFocusable(false);
        jtfDate.setPreferredSize(new java.awt.Dimension(75, 23));
        jpDocDate.add(jtfDate);

        jlSeries.setText("Serie y folio:");
        jlSeries.setPreferredSize(new java.awt.Dimension(100, 23));
        jpDocDate.add(jlSeries);

        jtfNumber.setEditable(false);
        jtfNumber.setBackground(new java.awt.Color(255, 204, 51));
        jtfNumber.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        jtfNumber.setText("NUMBER");
        jtfNumber.setFocusable(false);
        jtfNumber.setPreferredSize(new java.awt.Dimension(130, 23));
        jpDocDate.add(jtfNumber);

        jPanel3.add(jpDocDate);

        jpDocNumber.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jRef.setText("Referencia:");
        jRef.setPreferredSize(new java.awt.Dimension(100, 14));
        jpDocNumber.add(jRef);

        jtfRef.setText(" ");
        jtfRef.setCursor(new java.awt.Cursor(java.awt.Cursor.DEFAULT_CURSOR));
        jtfRef.setEnabled(false);
        jtfRef.setPreferredSize(new java.awt.Dimension(135, 23));
        jpDocNumber.add(jtfRef);

        jPanel3.add(jpDocNumber);

        jpWarehouseSource.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jlWarehouseSource.setText("Almacén origen:");
        jlWarehouseSource.setPreferredSize(new java.awt.Dimension(100, 23));
        jpWarehouseSource.add(jlWarehouseSource);

        jtfCompanyBranchSource.setBackground(java.awt.Color.lightGray);
        jtfCompanyBranchSource.setEditable(false);
        jtfCompanyBranchSource.setText("BRANCH");
        jtfCompanyBranchSource.setFocusable(false);
        jtfCompanyBranchSource.setPreferredSize(new java.awt.Dimension(75, 23));
        jpWarehouseSource.add(jtfCompanyBranchSource);

        jtfCompanyBranchSourceCode.setBackground(java.awt.Color.lightGray);
        jtfCompanyBranchSourceCode.setEditable(false);
        jtfCompanyBranchSourceCode.setText("CODE");
        jtfCompanyBranchSourceCode.setFocusable(false);
        jtfCompanyBranchSourceCode.setPreferredSize(new java.awt.Dimension(50, 23));
        jpWarehouseSource.add(jtfCompanyBranchSourceCode);

        jtfWarehouseSource.setBackground(java.awt.Color.lightGray);
        jtfWarehouseSource.setEditable(false);
        jtfWarehouseSource.setText("WAREHOUSE");
        jtfWarehouseSource.setFocusable(false);
        jtfWarehouseSource.setPreferredSize(new java.awt.Dimension(135, 23));
        jpWarehouseSource.add(jtfWarehouseSource);

        jtfWarehouseSourceCode.setBackground(java.awt.Color.lightGray);
        jtfWarehouseSourceCode.setEditable(false);
        jtfWarehouseSourceCode.setText("CODE");
        jtfWarehouseSourceCode.setFocusable(false);
        jtfWarehouseSourceCode.setPreferredSize(new java.awt.Dimension(50, 23));
        jpWarehouseSource.add(jtfWarehouseSourceCode);

        jPanel3.add(jpWarehouseSource);

        jpWarehouseDestiny.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 5, 0));

        jlWarehouseDestiny.setText("Almacén destino:");
        jlWarehouseDestiny.setPreferredSize(new java.awt.Dimension(100, 23));
        jpWarehouseDestiny.add(jlWarehouseDestiny);

        jtfCompanyBranchDestiny.setBackground(java.awt.Color.lightGray);
        jtfCompanyBranchDestiny.setEditable(false);
        jtfCompanyBranchDestiny.setText("BRANCH");
        jtfCompanyBranchDestiny.setFocusable(false);
        jtfCompanyBranchDestiny.setPreferredSize(new java.awt.Dimension(75, 23));
        jpWarehouseDestiny.add(jtfCompanyBranchDestiny);

        jtfCompanyBranchDestinyCode.setBackground(java.awt.Color.lightGray);
        jtfCompanyBranchDestinyCode.setEditable(false);
        jtfCompanyBranchDestinyCode.setText("CODE");
        jtfCompanyBranchDestinyCode.setFocusable(false);
        jtfCompanyBranchDestinyCode.setPreferredSize(new java.awt.Dimension(50, 23));
        jpWarehouseDestiny.add(jtfCompanyBranchDestinyCode);

        jtfWarehouseDestiny.setBackground(java.awt.Color.lightGray);
        jtfWarehouseDestiny.setEditable(false);
        jtfWarehouseDestiny.setText("WAREHOUSE");
        jtfWarehouseDestiny.setFocusable(false);
        jtfWarehouseDestiny.setPreferredSize(new java.awt.Dimension(135, 23));
        jpWarehouseDestiny.add(jtfWarehouseDestiny);

        jtfWarehouseDestinyCode.setBackground(java.awt.Color.lightGray);
        jtfWarehouseDestinyCode.setEditable(false);
        jtfWarehouseDestinyCode.setText("CODE");
        jtfWarehouseDestinyCode.setFocusable(false);
        jtfWarehouseDestinyCode.setPreferredSize(new java.awt.Dimension(50, 23));
        jpWarehouseDestiny.add(jtfWarehouseDestinyCode);

        jPanel3.add(jpWarehouseDestiny);

        jPanel2.add(jPanel3, java.awt.BorderLayout.PAGE_START);

        getContentPane().add(jPanel2, java.awt.BorderLayout.CENTER);

        jbPrintClose.setText("Imprimir y cerrar");
        jbPrintClose.setMargin(new java.awt.Insets(2, 2, 2, 2));
        jbPrintClose.setPreferredSize(new java.awt.Dimension(125, 23));
        jPanel1.add(jbPrintClose);

        jbSaveArchive.setText("Guardar");
        jbSaveArchive.setActionCommand("Guardar");
        jbSaveArchive.setMargin(new java.awt.Insets(2, 2, 2, 2));
        jbSaveArchive.setPreferredSize(new java.awt.Dimension(100, 23));
        jPanel1.add(jbSaveArchive);

        jbClose.setText("Cerrar");
        jbClose.setMargin(new java.awt.Insets(2, 2, 2, 2));
        jbClose.setPreferredSize(new java.awt.Dimension(75, 23));
        jPanel1.add(jbClose);

        getContentPane().add(jPanel1, java.awt.BorderLayout.PAGE_END);

        setSize(new java.awt.Dimension(488, 244));
        setLocationRelativeTo(null);
    }// </editor-fold>//GEN-END:initComponents

    private void formWindowActivated(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowActivated
        windowActivated();
    }//GEN-LAST:event_formWindowActivated

    private void initComponentsExtra() {
        jbPrintClose.addActionListener(this);
        jbSaveArchive.addActionListener(this);
        jbClose.addActionListener(this);

        SFormUtilities.createActionMap(rootPane, this, "actionClose", "close", KeyEvent.VK_ESCAPE, SLibConstants.UNDEFINED);
    }

    private void windowActivated() {
        if (mbFirstTime) { 
            mbFirstTime = false;
            jbClose.requestFocus();
        }
    }

    public void actionPrintClose() {
        STrnUtilities.printDiog(miClient, (int[]) moDiog.getPrimaryKey());
        setVisible(false);
    }
    
    public void actionSaveArchive() {
        STrnUtilities.saveDiog(miClient, (int[]) moDiog.getPrimaryKey());
        setVisible(false);
    }

    public void actionClose() {
        setVisible(false);
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel jLabel1;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JLabel jRef;
    private javax.swing.JButton jbClose;
    private javax.swing.JButton jbPrintClose;
    private javax.swing.JButton jbSaveArchive;
    private javax.swing.JLabel jlDate;
    private javax.swing.JLabel jlDiogType;
    private javax.swing.JLabel jlSeries;
    private javax.swing.JLabel jlWarehouseDestiny;
    private javax.swing.JLabel jlWarehouseSource;
    private javax.swing.JPanel jpDocDate;
    private javax.swing.JPanel jpDocNumber;
    private javax.swing.JPanel jpDocType;
    private javax.swing.JPanel jpWarehouseDestiny;
    private javax.swing.JPanel jpWarehouseSource;
    private javax.swing.JTextField jtfCompanyBranchDestiny;
    private javax.swing.JTextField jtfCompanyBranchDestinyCode;
    private javax.swing.JTextField jtfCompanyBranchSource;
    private javax.swing.JTextField jtfCompanyBranchSourceCode;
    private javax.swing.JTextField jtfDate;
    private javax.swing.JTextField jtfDiogType;
    private javax.swing.JTextField jtfNumber;
    private javax.swing.JTextField jtfRef;
    private javax.swing.JTextField jtfWarehouseDestiny;
    private javax.swing.JTextField jtfWarehouseDestinyCode;
    private javax.swing.JTextField jtfWarehouseSource;
    private javax.swing.JTextField jtfWarehouseSourceCode;
    // End of variables declaration//GEN-END:variables

    public void setFormParams(final erp.mtrn.data.SDataDiog diog) {
        moDiog = diog;

        jtfDiogType.setText((String) SDataReadDescriptions.getCatalogueDescription(miClient, SDataConstants.TRNS_TP_IOG, moDiog.getDiogTypeKey()));
        jtfDate.setText(miClient.getSessionXXX().getFormatters().getDateFormat().format(moDiog.getDate()));
        jtfNumber.setText((moDiog.getNumberSeries().length() == 0 ? "" : moDiog.getNumberSeries() + "-") +
                (moDiog.getNumber().length() >= SDataConstantsSys.NUM_LEN_IOG ? "" : SLibUtilities.textRepeat("0", SDataConstantsSys.NUM_LEN_IOG - moDiog.getNumber().length())) + moDiog.getNumber());
        jtfRef.setText(moDiog.getReference());
        jtfCompanyBranchSource.setText(moDiog.getDbmsCompanyBranch());
        jtfCompanyBranchSourceCode.setText(moDiog.getDbmsCompanyBranchCode());
        jtfWarehouseSource.setText(moDiog.getDbmsWarehouse());
        jtfWarehouseSourceCode.setText(moDiog.getDbmsWarehouseCode());

        if (moDiog.getDbmsDataCounterpartDiog() == null) {
            jlWarehouseDestiny.setEnabled(false);
            jtfCompanyBranchDestiny.setText("");
            jtfCompanyBranchDestinyCode.setText("");
            jtfWarehouseDestiny.setText("");
            jtfWarehouseDestinyCode.setText("");
        }
        else {
            jlWarehouseDestiny.setEnabled(true);
            jtfCompanyBranchDestiny.setText(moDiog.getDbmsDataCounterpartDiog().getDbmsCompanyBranch());
            jtfCompanyBranchDestinyCode.setText(moDiog.getDbmsDataCounterpartDiog().getDbmsCompanyBranchCode());
            jtfWarehouseDestiny.setText(moDiog.getDbmsDataCounterpartDiog().getDbmsWarehouse());
            jtfWarehouseDestinyCode.setText(moDiog.getDbmsDataCounterpartDiog().getDbmsWarehouseCode());
        }

        jtfDiogType.setCaretPosition(0);
        jtfDate.setCaretPosition(0);
        jtfNumber.setCaretPosition(0);

        jtfCompanyBranchSource.setCaretPosition(0);
        jtfCompanyBranchSourceCode.setCaretPosition(0);
        jtfWarehouseSource.setCaretPosition(0);
        jtfWarehouseSourceCode.setCaretPosition(0);

        jtfCompanyBranchDestiny.setCaretPosition(0);
        jtfCompanyBranchDestinyCode.setCaretPosition(0);
        jtfWarehouseDestiny.setCaretPosition(0);
        jtfWarehouseDestinyCode.setCaretPosition(0);
    }

    public void formReset() {
        mbFirstTime = true;
    }

    @Override
    public void actionPerformed(ActionEvent e) {
        if (e.getSource() instanceof JButton) {
            JButton button = (JButton) e.getSource();

            if (button == jbPrintClose) {
                actionPrintClose();
            }
            else if (button == jbSaveArchive) {
                actionSaveArchive();
            }
            else if (button == jbClose) {
                actionClose();
            }
        }
    }
}
